var NspBitFields=new function(){"use strict";var e=this,r="value",n=n,t=t,i=Math.floor,u=Math.ceil,o=Object.prototype.toString,f={stringType:"[object String]",numberType:"[object Number]"},s=function(e){return e===t||e===n},a=function(e){return o.call(e)===f.numberType},l=function(e){return o.call(e)===f.stringType},d=function(e){return s(e)||a(e)||l(e)},v=[null,void 0],c=function(e){return v.indexOf(e)<0},y="NSP"+("00000"+i(1e6*Math.random())).slice(-6),p={errs:function(){return{}},warns:function(){return{}},errorHandler:function(){return function(e){return n}},warningHandler:function(){return function(e){return null}},byteArray:function(){return Array.prototype.constructor},fieldArray:function(){return Array.prototype.constructor}};this.BitFieldsPresets=function(){var e=p;for(var r in e)this[r]=e[r]()},this.BitFieldsFormat=function(i,u){var o=this,f={lenDefined:{value:t},lenAligned:{value:t},valsDefined:{value:t},firstIndexOne:{value:n},fieldsSize:{value:0},byteLenBits:{value:null},fieldRepeats:{value:null},bytesNumber:{value:null}};o[y]={fields:[],fieldsIndex:{}},void 0!==i&&void 0===u&&i instanceof e.BitFieldsPresets&&(u=i,i=void 0),void 0===u&&(u=new e.BitFieldsPresets),void 0===i&&(i=1);var s=8*i;f.byteLenBits[r]=Math.round(s),o.addField=function(e,n){return o[y].fieldsIndex[e]=o[y].fields[o[y].fields.push({name:e,size:n})-1],f.fieldsSize[r]+=n,o},o.modField=function(e,n){return f.fieldsSize[r]+=n-o[y].fieldsIndex[e].size,o[y].fieldsIndex[e].size=n,o},o.addFields=function(e){for(var r in e)o.addField(r,e[r]);return o},o.modFields=function(e){for(var r in e)o.modField(r,e[r]);return o},o.skipFields=function(){return f.fieldsSize[r]=0,o[y].fieldsIndex={},o[y].fields=[],o},o.setProperty=function(e,n){return f[e][r]=n,o},o.setProperties=function(e){for(var n in e)f[n][r]=e[n];return o},o.getProperty=function(e){return f[e][r]}},this.BitFields=function(f,s){var a,v,p,g,h,m,b,F,z=this,B=[],w={},x={},S=function(e){for(var n=0;n<B.length;n++){B[n][r]=[],w[B[n].name]=[];for(var i=0;i<e;i++)B[n][r][i]=0,w[B[n].name][i]=t}};void 0===s&&(s=new e.BitFieldsPresets);for(var A in f[y].fieldsIndex){var I=f[y].fieldsIndex[A].size;x[A]=B[B.push({name:A,size:I,value:[]})-1],w[A]=[]}var N=f.getProperty;a=N("lenDefined"),N("lenAligned"),N("valsDefined"),v=N("fieldsSize"),p=N("byteLenBits"),g=N("fieldRepeats"),h=N("bytesNumber"),b=N("firstIndexOne");var P,V,M=c(g),O=c(h);if(a){if(M){P=u(v*g/p)}if(O){V=i(p*h/v)}M&&O||(M&&(h=P),O&&(g=V))}m=a?g:0,F=b?1:0,z.getRowNum=function(){return m},z.getRowSize=function(){return v},z.getTotalSize=function(){return v*m},z.getBytesNum=function(){return h},z.setValue=function(e,n,i){return void 0===i&&(i=n,n=e,e=F),e-=F,x[n][r][e]=i,w[n][e]=t,!a&&e+1>m&&(m=e+1),z},z.setValues=function(e,n){void 0===n&&(n=e,e=F),e-=F;for(var i in n)c(n[i])&&(x[i][r][e]=n[i],w[i][e]=t);return!a&&e+1>m&&(m=e+1),z},z.getValue=function(e,n){void 0===n&&(n=e,e=F),e-=F;var i=x[n][r][e];return w[n][e]!==t&&(i=0),i},z.getValues=function(e,i){var u=t;c(i)||(c(e)&&!d(e)?(i=e,e=void 0):(i={},u=n)),c(e)||(e=F),e-=F;for(var o in x){var f=x[o][r][e];w[o][e]!==t&&(f=0),i[o]=f}return u?z:i},z.skipValues=function(){for(var e=0;e<B.length;e++)B[e][r]=[],w[B[e].name]=[];return a||(m=0),z},z.selName=function(e){return new function(e){this.setValues=function(n){var i=n.length-1;if(i<0)return z;for(var u=0;u<=i;u++)c(n[u])&&(x[e][r][u]=n[u],w[e][u]=t);return!a&&i+1>m&&(m=i+1),z},this.getValues=function(){for(var n=new s.fieldArray(m),i=0;i<m;i++){var u=x[e][r][i];w[e][i]!==t&&(u=0),n[i]=u}return n}}(e)},z.setBytes=function(e,n,t){var u=l(e),o=e.length;c(n)?n<0&&(n=o+n+F):n=F,c(t)?t<0&&(t=o+t+F):t=a&&c(n)?n+h:o+F,n-=F,t-=F;var f,s;if(f=t-n,a)s=g;else{s=i(p*f/v)}var d;d=u?new Array(f):new e.constructor(f);for(var y=n;y<t;y++){d[y-n]=u?e.charCodeAt(y):e[y]}m=s,S(s);for(var b=B.length,w=0,x=0,A=B[w].size,I=A,y=0;y<f;y++)for(var N=d[y],P=p;P;){var V=I;P<I&&(V=P);var M=N>>>P-V;if(M&=Math.pow(2,V)-1,M<<=I-V,B[w][r][x]+=M,P-=V,0==(I-=V)){if(++w>=b){if(++x>=s)return z;w=0}A=B[w].size,I=A}}return z},z.getBytes=function(){var e=p,n=0,t=m*v,i=t/p;i=u(i);for(var o=new s.byteArray(i),f=0;f<i;f++)o[f]=0;for(var a=0;a<m;a++)for(var f in x)for(var l=x[f][r][a],d=x[f].size,c=d;c;){var y=e;c<e&&(y=c);var g=l>>>c-y;g&=Math.pow(2,y)-1,g<<=e-y,o[n]+=g,e-=y,c-=y,0==e&&(n++,e=p)}return o},z.valueOf=function(){if(8==p||16==p){for(var e=z.getBytes(),r="",n=0;n<e.length;n++)r+=String.fromCharCode(e[n]);return r}return o.call(z)}}};"object"==typeof exports&&"undefined"!=typeof module&&(module.exports=NspBitFields);