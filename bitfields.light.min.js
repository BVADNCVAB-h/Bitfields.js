var NspBitFields=new function(){"use strict";var s=this,P="value",c="BitFieldsPresets",O="constructor",j="length",e="prototype",C="size",D="name",d="fieldsIndex",u="fields",a="fieldsSize",y="push",g=g,I=I,h=void 0,M=Math.floor,m=Math.ceil,p=Object[e].toString,r="[object String]",t="[object Number]",R=function(e){return p.call(e)===r},L=function(e){return(n=e)===I||n===g||(r=e,p.call(r)===t)||R(e);var r,n},o=null,n=[o,h],k=function(e){return n.indexOf(e)<0},H="NSP"+("00000"+M(1e6*Math.random())).slice(-6),i={errs:function(){return{}},warns:function(){return{}},errorHandler:function(){return function(e){return g}},warningHandler:function(){return function(e){return null}},byteArray:function(){return Array[e][O]},fieldArray:function(){return Array[e][O]}};this[c]=function(){var e=i;for(var r in e)this[r]=e[r]()},this.BitFieldsFormat=function(e,r){var n=this,t={lenDefined:{value:I},lenAligned:{value:I},valsDefined:{value:I},firstIndexOne:{value:g},fieldsSize:{value:0},byteLenBits:{value:o},fieldRepeats:{value:o},bytesNumber:{value:o}};n[H]={fields:[],fieldsIndex:{}},e!==h&&r===h&&e instanceof s[c]&&(r=e,e=h),r===h&&(r=new s[c]),e===h&&(e=1);var i=8*e;t.byteLenBits[P]=Math.round(i),n.addField=function(e,r){return n[H][d][e]=n[H][u][n[H][u][y]({name:e,size:r})-1],t[a][P]+=r,n},n.modField=function(e,r){return t[a][P]+=r-n[H][d][e][C],n[H][d][e][C]=r,n},n.addFields=function(e){for(var r in e)n.addField(r,e[r]);return n},n.modFields=function(e){for(var r in e)n.modField(r,e[r]);return n},n.skipFields=function(){return t[a][P]=0,n[H][d]={},n[H][u]=[],n},n.setProperty=function(e,r){return t[e][P]=r,n},n.setProperties=function(e){for(var r in e)t[r][P]=e[r];return n},n.getProperty=function(e){return t[e][P]}},this.BitFields=function(e,l){var b,F,w,B,A,N,r,S,z=this,x=[],V={},v={};for(var n in l===h&&(l=new s[c]),e[H][d]){var t=e[H][d][n][C];v[n]=x[x[y]({name:n,size:t,value:[]})-1],V[n]=[]}var i=e.getProperty;b=i("lenDefined"),i("lenAligned"),i("valsDefined"),F=i("fieldsSize"),w=i("byteLenBits"),B=i("fieldRepeats"),A=i("bytesNumber"),r=i("firstIndexOne");var u,a,o=k(B),f=k(A);if(b){if(o)u=m(F*B/w);if(f)a=M(w*A/F);o&&f||(o&&(A=u),f&&(B=a))}N=b?B:0,S=r?1:0,z.getRowNum=function(){return N},z.getRowSize=function(){return F},z.getTotalSize=function(){return F*N},z.getBytesNum=function(){return A},z.setValue=function(e,r,n){return n===h&&(n=r,r=e,e=S),e-=S,v[r][P][e]=n,V[r][e]=I,!b&&N<e+1&&(N=e+1),z},z.setValues=function(e,r){for(var n in r===h&&(r=e,e=S),e-=S,r)k(r[n])&&(v[n][P][e]=r[n],V[n][e]=I);return!b&&N<e+1&&(N=e+1),z},z.getValue=function(e,r){r===h&&(r=e,e=S),e-=S;var n=v[r][P][e];return V[r][e]!==I&&(n=0),n},z.getValues=function(e,r){var n=I;for(var t in k(r)||(k(e)&&!L(e)?(r=e,e=h):(r={},n=g)),k(e)||(e=S),e-=S,v){var i=v[t][P][e];V[t][e]!==I&&(i=0),r[t]=i}return n?z:r},z.skipValues=function(){for(var e=0;e<x[j];e++)x[e][P]=[],V[x[e][D]]=[];return b||(N=0),z},z.selName=function(e){return new function(t){this.setValues=function(e){var r=e[j]-1;if(r<0)return z;for(var n=0;n<=r;n++)k(e[n])&&(v[t][P][n]=e[n],V[t][n]=I);return!b&&N<r+1&&(N=r+1),z},this.getValues=function(){for(var e=new l.fieldArray(N),r=0;r<N;r++){var n=v[t][P][r];V[t][r]!==I&&(n=0),e[r]=n}return e}}(e)},z.setBytes=function(e,r,n){var t,i,u,a=R(e),o=e[j];(k(r)?r<0&&(r=o+r+S):r=S,k(n)?n<0&&(n=o+n+S):n=b&&k(r)?r+A:o+S,t=(n-=S)-(r-=S),b)?i=B:i=M(w*t/F);u=a?new Array(t):new e[O](t);for(var f=r;f<n;f++){var s=f-r;a?e.charCodeAt(f):e[f];u[s]=a?e.charCodeAt(f):e[f]}!function(e){for(var r=0;r<x[j];r++){x[r][P]=[],V[x[r][D]]=[];for(var n=0;n<e;n++)x[r][P][n]=0,V[x[r][D]][n]=I}}(N=i);var l=x[j],v=0,c=0,d=x[v][C],y=d;for(f=0;f<t;f++)for(var g=u[f],h=w;h;){var m=y;h<y&&(m=h);var p=g>>h-m;if(p&=(1<<m)-1,p<<=y-m,x[v][P][c]+=p,h-=m,0==(y-=m)){if(++v>=l){if(++c>=i)return z;v=0}y=d=x[v][C]}}return z},z.getBytes=function(){var e=w,r=0,n=N*F/w;n=m(n);for(var t=new l.byteArray(n),i=0;i<n;i++)t[i]=0;for(var u=0;u<N;u++)for(var i in v)for(var a=v[i][P][u],o=v[i][C];o;){var f=e;o<e&&(f=o);var s=a>>o-f;s&=(1<<f)-1,s<<=e-f,t[r]+=s,o-=f,0==(e-=f)&&(r++,e=w)}return t},z.valueOf=function(){if(8!=w&&16!=w)return p.call(z);for(var e=z.getBytes(),r="",n=0;n<e[j];n++)r+=String.fromCharCode(e[n]);return r}}};"object"==typeof exports&&"undefined"!=typeof module&&(module.exports=NspBitFields);